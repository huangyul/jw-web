# Vue 核心源码分析

> 带着问题学习？
>
> 1. react 和 vue 的 diff 算法有什么区别
> 2. 传统的 diff O(n^3)，react O(n)？怎么来的，还可以优化吗？

## 几个常见问题

###### 1. 为什么要 diff

1. 本质上就是为了性能！！
2. 简化操作 dom 的方式（数据的双向绑定），通过数据影响视图

MVVM 的本质： **数据模型** -> **virtual dom** -> **视图(dom)**，通过虚拟 dom 去关联数据模型和视图

虚拟 Dom 本质就是一个对象

```js
{
  type: 'div',
  props: {...}
}
```

注意：真实 dom 操作并不慢，不一定真实 dom 就是慢！！

但是真实操作 dom，会容易引起重绘和回流

###### 2. 为什么是 O(n^3)？怎么来的？

字符串的最小编辑距离需要`O(n^2)`，树的最小编辑距离需要`O(n^3)`

###### 3. react 为什么是 O(n)？

因为使用了同层比较
其实真实是 `O(mn)`，经过优化可以达到 `O(n)`

```js
for(let i = 0; i < oldArr.length; i++) {
  if(old[i].type !== new[i].type) {
    replace()
  } else (old[i].children && old[i].children.length) {
    // 假如没有这里，就是最优解
  }
}
```

###### 4. 如何做到 O(n)

1. 同层比较，通过 type 类型来判断，如果不同，直接删掉**原节点**；如果相同，就递归遍历**children**
2. 同一层级的子元素，可以通过**key**来缓存实例
3. 完全相同的节点，其虚拟 dom 也是一致的

